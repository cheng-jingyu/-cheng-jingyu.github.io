<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>数据库之mysql | smile~</title><meta name="author" content="cjy"><meta name="copyright" content="cjy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="基础篇1.1 通用语法及分类DDL: 数据定义语言，用来定义数据库对象（数据库、表、字段）DML: 数据操作语言，用来对数据库表中的数据进行增删改DQL: 数据查询语言，用来查询数据库中表的记录DCL: 数据控制语言，用来创建数据库用户、控制数据库的控制权限DDL（数据定义语言）数据定义语言  数据库操作查询所有数据库：SHOW DATABASES;查询当前数据库：SELECT DATABASE">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库之mysql">
<meta property="og:url" content="https://www.chengjingyu.xyz/2022/04/22/mysql/index.html">
<meta property="og:site_name" content="smile~">
<meta property="og:description" content="基础篇1.1 通用语法及分类DDL: 数据定义语言，用来定义数据库对象（数据库、表、字段）DML: 数据操作语言，用来对数据库表中的数据进行增删改DQL: 数据查询语言，用来查询数据库中表的记录DCL: 数据控制语言，用来创建数据库用户、控制数据库的控制权限DDL（数据定义语言）数据定义语言  数据库操作查询所有数据库：SHOW DATABASES;查询当前数据库：SELECT DATABASE">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.chengjingyu.xyz/pic.chengjingyu.xyz/img_win/default_cover_113.webp">
<meta property="article:published_time" content="2022-04-21T16:00:00.000Z">
<meta property="article:modified_time" content="2022-12-11T12:45:23.883Z">
<meta property="article:author" content="cjy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.chengjingyu.xyz/pic.chengjingyu.xyz/img_win/default_cover_113.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.chengjingyu.xyz/2022/04/22/mysql/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据库之mysql',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-12-11 20:45:23'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="/js/SAO-Notify.js" async></script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" link="/css/loading_wizard.css"/><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%5Cassets%5Chead1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://pic.chengjingyu.xyz/MUSIC/music.html"><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><span> 照片</span></a></li><li><a class="site-page child" href="/dh/"><span> 动画</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/hl/"><span> 画廊</span></a></li><li><a class="site-page child" href="/movies/"><span> 影院</span></a></li><li><a class="site-page child" href="/game/"><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/zs/"><span> 自述</span></a></li><li><a class="site-page child" href="/select/"><span> 内心</span></a></li><li><a class="site-page child" href="/random/"><span> 瞎逛</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/daohang/"><span> 导航</span></a></li><li><a class="site-page child" href="/sm/"><span> 声明</span></a></li><li><a class="site-page child" href="/comments/"><span> 留言</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.chengjingyu.xyz/pic.chengjingyu.xyz/img_win/default_cover_113.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">smile~</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://pic.chengjingyu.xyz/MUSIC/music.html"><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><span> 照片</span></a></li><li><a class="site-page child" href="/dh/"><span> 动画</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/hl/"><span> 画廊</span></a></li><li><a class="site-page child" href="/movies/"><span> 影院</span></a></li><li><a class="site-page child" href="/game/"><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/zs/"><span> 自述</span></a></li><li><a class="site-page child" href="/select/"><span> 内心</span></a></li><li><a class="site-page child" href="/random/"><span> 瞎逛</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><span> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/daohang/"><span> 导航</span></a></li><li><a class="site-page child" href="/sm/"><span> 声明</span></a></li><li><a class="site-page child" href="/comments/"><span> 留言</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">数据库之mysql</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2022-04-21T16:00:00.000Z" title="发表于 2022-04-22 00:00:00">2022-04-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="数据库之mysql"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout hide-aside" id="content-inner"><div id="post"><article class="post-content" id="article-container"><ol>
<li>基础篇<br>1.1 通用语法及分类<br>DDL: 数据定义语言，用来定义数据库对象（数据库、表、字段）<br>DML: 数据操作语言，用来对数据库表中的数据进行增删改<br>DQL: 数据查询语言，用来查询数据库中表的记录<br>DCL: 数据控制语言，用来创建数据库用户、控制数据库的控制权限<br>DDL（数据定义语言）<br>数据定义语言</li>
</ol>
<p>数据库操作<br>查询所有数据库：<br>SHOW DATABASES;<br>查询当前数据库：<br>SELECT DATABASE();<br>创建数据库：<br>CREATE DATABASE [ IF NOT EXISTS ] 数据库名 [ DEFAULT CHARSET 字符集] [COLLATE 排序规则 ];<br>删除数据库：<br>DROP DATABASE [ IF EXISTS ] 数据库名;<br>使用数据库：<br>USE 数据库名;</p>
<p>注意事项<br>UTF8 字符集长度为 3 字节，有些符号占 4 字节，所以推荐用 utf8mb4 字符集<br>表操作<br>查询当前数据库所有表：<br>SHOW TABLES;<br>查询表结构：<br>DESC 表名;<br>查询指定表的建表语句：<br>SHOW CREATE TABLE 表名;</p>
<p>创建表：</p>
<p>CREATE TABLE 表名(<br>    字段1 字段1类型 [COMMENT 字段1注释],<br>    字段2 字段2类型 [COMMENT 字段2注释],<br>    字段3 字段3类型 [COMMENT 字段3注释],<br>    …<br>    字段n 字段n类型 [COMMENT 字段n注释]<br>)[ COMMENT 表注释 ];<br>最后一个字段后面没有逗号</p>
<p>添加字段：<br>ALTER TABLE 表名 ADD 字段名 类型(长度) [COMMENT 注释] [约束];<br>例：ALTER TABLE emp ADD nickname varchar(20) COMMENT ‘昵称’;</p>
<p>修改数据类型：<br>ALTER TABLE 表名 MODIFY 字段名 新数据类型(长度);<br>修改字段名和字段类型：<br>ALTER TABLE 表名 CHANGE 旧字段名 新字段名 类型(长度) [COMMENT 注释] [约束];<br>例：将 emp 表的 nickname 字段修改为 username，类型为 varchar (30)<br>ALTER TABLE emp CHANGE nickname username varchar(30) COMMENT ‘昵称’;</p>
<p>删除字段：<br>ALTER TABLE 表名 DROP 字段名;</p>
<p>修改表名：<br>ALTER TABLE 表名 RENAME TO 新表名</p>
<p>删除表：<br>DROP TABLE [IF EXISTS] 表名;<br>删除表，并重新创建该表：<br>TRUNCATE TABLE 表名;</p>
<p>DML（数据操作语言）<br>添加数据<br>指定字段：<br>INSERT INTO 表名 (字段名1, 字段名2, …) VALUES (值1, 值2, …);<br>全部字段：<br>INSERT INTO 表名 VALUES (值1, 值2, …);</p>
<p>批量添加数据：<br>INSERT INTO 表名 (字段名1, 字段名2, …) VALUES (值1, 值2, …), (值1, 值2, …), (值1, 值2, …);<br>INSERT INTO 表名 VALUES (值1, 值2, …), (值1, 值2, …), (值1, 值2, …);</p>
<p>注意事项<br>字符串和日期类型数据应该包含在引号中<br>插入的数据大小应该在字段的规定范围内<br>更新和删除数据<br>修改数据：<br>UPDATE 表名 SET 字段名1 = 值1, 字段名2 = 值2, … [ WHERE 条件 ];<br>例：<br>UPDATE emp SET name = ‘Jack’ WHERE id = 1;</p>
<p>删除数据：<br>DELETE FROM 表名 [ WHERE 条件 ];</p>
<p>DQL（数据查询语言）<br>语法：</p>
<p>SELECT<br>    字段列表<br>FROM<br>    表名字段<br>WHERE<br>    条件列表<br>GROUP BY<br>    分组字段列表<br>HAVING<br>    分组后的条件列表<br>ORDER BY<br>    排序字段列表<br>LIMIT<br>    分页参数<br>基础查询<br>查询多个字段：<br>SELECT 字段1, 字段2, 字段3, … FROM 表名;<br>SELECT * FROM 表名;</p>
<p>设置别名：<br>SELECT 字段1 [ AS 别名1 ], 字段2 [ AS 别名2 ], 字段3 [ AS 别名3 ], … FROM 表名;<br>SELECT 字段1 [ 别名1 ], 字段2 [ 别名2 ], 字段3 [ 别名3 ], … FROM 表名;</p>
<p>去除重复记录：<br>SELECT DISTINCT 字段列表 FROM 表名;</p>
<p>转义：<br>SELECT * FROM 表名 WHERE name LIKE ‘/<em>张三’ ESCAPE ‘/‘<br>/ 之后的</em>不作为通配符</p>
<p>条件查询<br>语法：<br>SELECT 字段列表 FROM 表名 WHERE 条件列表;</p>
<p>条件：</p>
<p>比较运算符    功能</p>
<blockquote>
<p>   大于<br>=    大于等于<br>&lt;    小于<br>&lt;=    小于等于<br>=    等于<br>&lt;&gt; 或！=    不等于<br>BETWEEN … AND …    在某个范围内（含最小、最大值）<br>IN(…)    在 in 之后的列表中的值，多选一<br>LIKE 占位符    模糊匹配（_匹配单个字符，% 匹配任意个字符）<br>IS NULL    是 NULL<br>逻辑运算符    功能<br>AND 或 &amp;&amp;    并且（多个条件同时成立）<br>OR 或 ||    或者（多个条件任意一个成立）<br>NOT 或！    非，不是<br>例子：</p>
</blockquote>
<p>— 年龄等于30<br>select <em> from employee where age = 30;<br>— 年龄小于30<br>select </em> from employee where age &lt; 30;<br>— 小于等于<br>select <em> from employee where age &lt;= 30;<br>— 没有身份证<br>select </em> from employee where idcard is null or idcard = ‘’;<br>— 有身份证<br>select <em> from employee where idcard;<br>select </em> from employee where idcard is not null;<br>— 不等于<br>select <em> from employee where age != 30;<br>— 年龄在20到30之间<br>select </em> from employee where age between 20 and 30;<br>select <em> from employee where age &gt;= 20 and age &lt;= 30;<br>— 下面语句不报错，但查不到任何信息<br>select </em> from employee where age between 30 and 20;<br>— 性别为女且年龄小于30<br>select <em> from employee where age &lt; 30 and gender = ‘女’;<br>— 年龄等于25或30或35<br>select </em> from employee where age = 25 or age = 30 or age = 35;<br>select <em> from employee where age in (25, 30, 35);<br>— 姓名为两个字<br>select </em> from employee where name like ‘__’;<br>— 身份证最后为X<br>select * from employee where idcard like ‘%X’;<br>聚合查询（聚合函数）<br>常见聚合函数 (null 值不参与聚合函数运算)：</p>
<p>函数    功能<br>count    统计数量<br>max    最大值<br>min    最小值<br>avg    平均值<br>sum    求和<br>语法：<br>SELECT 聚合函数(字段列表) FROM 表名;<br>例：<br>SELECT count(id) from employee where workaddress = “广东省”;</p>
<p>分组查询<br>语法：<br>SELECT 字段列表 FROM 表名 [ WHERE 条件 ] GROUP BY 分组字段名 [ HAVING 分组后的过滤条件 ];</p>
<p>where 和 having 的区别：</p>
<p>执行时机不同：where 是分组之前进行过滤，不满足 where 条件不参与分组；having 是分组后对结果进行过滤。<br>判断条件不同：where 不能对聚合函数进行判断，而 having 可以。<br>例子：</p>
<p>— 根据性别分组，统计男性和女性数量（只显示分组数量，不显示哪个是男哪个是女）<br>select count(<em>) from employee group by gender;<br>— 根据性别分组，统计男性和女性数量<br>select gender, count(</em>) from employee group by gender;<br>— 根据性别分组，统计男性和女性的平均年龄<br>select gender, avg(age) from employee group by gender;<br>— 年龄小于45，并根据工作地址分组<br>select workaddress, count(<em>) from employee where age &lt; 45 group by workaddress;<br>— 年龄小于45，并根据工作地址分组，获取员工数量大于等于3的工作地址<br>select workaddress, count(</em>) address_count from employee where age &lt; 45 group by workaddress having address_count &gt;= 3;<br>注意事项<br>执行顺序：where &gt; 聚合函数 &gt; having<br>分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义<br>排序查询<br>语法：<br>SELECT 字段列表 FROM 表名 ORDER BY 字段1 排序方式1, 字段2 排序方式2;</p>
<p>排序方式：</p>
<p>ASC: 升序（默认）<br>DESC: 降序<br>例子：</p>
<p>— 根据年龄升序排序<br>SELECT <em> FROM employee ORDER BY age ASC;<br>SELECT </em> FROM employee ORDER BY age;<br>— 两字段排序，根据年龄升序排序，入职时间降序排序<br>SELECT * FROM employee ORDER BY age ASC, entrydate DESC;<br>注意事项<br>如果是多字段排序，当第一个字段值相同时，才会根据第二个字段进行排序</p>
<p>分页查询<br>语法：<br>SELECT 字段列表 FROM 表名 LIMIT 起始索引, 查询记录数;</p>
<p>例子：</p>
<p>— 查询第一页数据，展示10条<br>SELECT <em> FROM employee LIMIT 0, 10;<br>— 查询第二页<br>SELECT </em> FROM employee LIMIT 10, 10;<br>注意事项<br>起始索引从 0 开始，起始索引 = （查询页码 - 1） * 每页显示记录数<br>分页查询是数据库的方言，不同数据库有不同实现，MySQL 是 LIMIT<br>如果查询的是第一页数据，起始索引可以省略，直接简写 LIMIT 10<br>DQL 执行顺序<br>1.FROM (从哪张表查询) -&gt; 2.WHERE (对数据进行筛选) -&gt; 3.GROUP BY (对筛选的数据进行分组) -&gt; 4.HAVING (分组后的条件列表)-&gt; 5.SELECT (选择对应数据) -&gt; 6.ORDER BY (对结果排序) -&gt; 7.LIMIT (对结果分页)</p>
<p>DCL<br>管理用户<br>查询用户：</p>
<p>USER mysql;<br>SELECT * FROM user;<br>创建用户:<br>CREATE USER ‘用户名’@’主机名’ IDENTIFIED BY ‘密码’;</p>
<p>修改用户密码：<br>ALTER USER ‘用户名’@’主机名’ IDENTIFIED WITH mysql_native_password BY ‘新密码’;</p>
<p>删除用户：<br>DROP USER ‘用户名’@’主机名’;</p>
<p>例子：</p>
<p>— 创建用户test，只能在当前主机localhost访问<br>create user ‘test’@’localhost’ identified by ‘123456’;<br>— 创建用户test，能在任意主机访问<br>create user ‘test’@’%’ identified by ‘123456’;<br>create user ‘test’ identified by ‘123456’;<br>— 修改密码<br>alter user ‘test’@’localhost’ identified with mysql_native_password by ‘1234’;<br>— 删除用户<br>drop user ‘test’@’localhost’;<br>注意事项<br>主机名可以使用 % 通配<br>权限控制<br>常用权限：</p>
<p>权限    说明<br>ALL, ALL PRIVILEGES    所有权限<br>SELECT    查询数据<br>INSERT    插入数据<br>UPDATE    修改数据<br>DELETE    删除数据<br>ALTER    修改表<br>DROP    删除数据库 / 表 / 视图<br>CREATE    创建数据库 / 表<br>更多权限请看权限一览表</p>
<p>查询权限：<br>SHOW GRANTS FOR ‘用户名’@’主机名’;</p>
<p>授予权限：<br>GRANT 权限列表 ON 数据库名.表名 TO ‘用户名’@’主机名’;</p>
<p>撤销权限：<br>REVOKE 权限列表 ON 数据库名.表名 FROM ‘用户名’@’主机名’;</p>
<p>注意事项<br>多个权限用逗号分隔<br>授权时，数据库名和表名可以用 * 进行通配，代表所有<br>1.2 函数<br>字符串函数<br>数值函数<br>日期函数<br>流程函数<br>字符串函数<br>常用函数：</p>
<p>函数    功能<br>CONCAT(s1, s2, …, sn)    字符串拼接，将 s1, s2, …, sn 拼接成一个字符串<br>LOWER(str)    将字符串全部转为小写<br>UPPER(str)    将字符串全部转为大写<br>LPAD(str, n, pad)    左填充，用字符串 pad 对 str 的左边进行填充，达到 n 个字符串长度<br>RPAD(str, n, pad)    右填充，用字符串 pad 对 str 的右边进行填充，达到 n 个字符串长度<br>TRIM(str)    去掉字符串头部和尾部的空格<br>SUBSTRING(str, start, len)    返回从字符串 str 从 start 位置起的 len 个长度的字符串（注意索引从 1 开始）<br>使用示例：</p>
<p>— 拼接<br>SELECT CONCAT(‘Hello’, ‘World’);<br>— 小写<br>SELECT LOWER(‘Hello’);<br>— 大写<br>SELECT UPPER(‘Hello’);<br>— 左填充<br>SELECT LPAD(‘01’, 5, ‘-‘);<br>— 右填充<br>SELECT RPAD(‘01’, 5, ‘-‘);<br>— 去除空格<br>SELECT TRIM(‘ Hello World ‘);<br>— 切片（起始索引为1）<br>SELECT SUBSTRING(‘Hello World’, 1, 5);<br>数值函数<br>常见函数：</p>
<p>函数    功能<br>CEIL(x)    向上取整<br>FLOOR(x)    向下取整<br>MOD(x, y)    返回 x/y 的模<br>RAND()    返回 0~1 内的随机数<br>ROUND(x, y)    求参数 x 的四舍五入值，保留 y 位小数<br>日期函数<br>常用函数：</p>
<p>函数    功能<br>CURDATE()    返回当前日期<br>CURTIME()    返回当前时间<br>NOW()    返回当前日期和时间<br>YEAR(date)    获取指定 date 的年份<br>MONTH(date)    获取指定 date 的月份<br>DAY(date)    获取指定 date 的日期<br>DATE_ADD(date, INTERVAL expr type)    返回一个日期 / 时间值加上一个时间间隔 expr 后的时间值<br>DATEDIFF(date1, date2)    返回起始时间 date1 和结束时间 date2 之间的天数<br>例子：</p>
<p>— DATE_ADD<br>SELECT DATE_ADD(NOW(), INTERVAL 70 YEAR);<br>流程函数<br>常用函数：</p>
<p>函数    功能<br>IF(value, t, f)    如果 value 为 true，则返回 t，否则返回 f<br>IFNULL(value1, value2)    如果 value1 不为空，返回 value1，否则返回 value2<br>CASE WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END    如果 val1 为 true，返回 res1，… 否则返回 default 默认值<br>CASE [ expr ] WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END    如果 expr 的值等于 val1，返回 res1，… 否则返回 default 默认值<br>例子：</p>
<p>select<br>    name,<br>    (case when age &gt; 30 then ‘中年’ else ‘青年’ end)<br>from employee;<br>select<br>    name,<br>    (case workaddress when ‘北京市’ then ‘一线城市’ when ‘上海市’ then ‘一线城市’ else ‘二线城市’ end) as ‘工作地址’<br>from employee;<br>1.3 约束<br>分类：</p>
<p>约束    描述    关键字<br>非空约束    限制该字段的数据不能为 null    NOT NULL<br>唯一约束    保证该字段的所有数据都是唯一、不重复的    UNIQUE<br>主键约束    主键是一行数据的唯一标识，要求非空且唯一    PRIMARY KEY<br>默认约束    保存数据时，如果未指定该字段的值，则采用默认值    DEFAULT<br>检查约束（8.0.1 版本后）    保证字段值满足某一个条件    CHECK<br>外键约束    用来让两张表的数据之间建立连接，保证数据的一致性和完整性    FOREIGN KEY<br>约束是作用于表中字段上的，可以再创建表 / 修改表的时候添加约束。</p>
<p>常用约束<br>约束条件    关键字<br>主键    PRIMARY KEY<br>自动增长    AUTO_INCREMENT<br>不为空    NOT NULL<br>唯一    UNIQUE<br>逻辑条件    CHECK<br>默认值    DEFAULT<br>例子：</p>
<p>create table user(<br>    id int primary key auto_increment,<br>    name varchar(10) not null unique,<br>    age int check(age &gt; 0 and age &lt; 120),<br>    status char(1) default ‘1’,<br>    gender char(1)<br>);<br>外键约束<br>作用：保证数据一致性与完整性</p>
<p>添加外键：</p>
<p>CREATE TABLE 表名(<br>    字段名 字段类型,<br>    …<br>    [CONSTRAINT] [外键名称] FOREIGN KEY(外键字段名) REFERENCES 主表(主表列名)<br>);<br>ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段名) REFERENCES 主表(主表列名);</p>
<p>— 例子<br>alter table emp add constraint fk_emp_dept_id foreign key(dept_id) references dept(id);<br>删除外键：<br>ALTER TABLE 表名 DROP FOREIGN KEY 外键名;</p>
<p>删除 / 更新行为<br>行为    说明<br>NO ACTION    当在父表中删除 / 更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除 / 更新（与 RESTRICT 一致）<br>RESTRICT    当在父表中删除 / 更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除 / 更新（与 NO ACTION 一致）<br>CASCADE    当在父表中删除 / 更新对应记录时，首先检查该记录是否有对应外键，如果有则也删除 / 更新外键在子表中的记录<br>SET NULL    当在父表中删除 / 更新对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为 null（要求该外键允许为 null）<br>SET DEFAULT    父表有变更时，子表将外键设为一个默认值（Innodb 不支持）<br>更改删除 / 更新行为：<br>ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段) REFERENCES 主表名(主表字段名) ON UPDATE 行为 ON DELETE 行为;</p>
<p>1.4 多表查询<br>多表关系<br>一对多（多对一）<br>多对多<br>一对一<br>一对多<br>案例：部门与员工<br>关系：一个部门对应多个员工，一个员工对应一个部门<br>实现：在多的一方建立外键，指向一的一方的主键</p>
<p>多对多<br>案例：学生与课程<br>关系：一个学生可以选多门课程，一门课程也可以供多个学生选修<br>实现：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</p>
<p>一对一<br>案例：用户与用户详情<br>关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他详情字段放在另一张表中，以提升操作效率<br>实现：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（UNIQUE）</p>
<p>查询<br>合并查询（笛卡尔积，会展示所有组合结果）：<br>select * from employee, dept;</p>
<p>笛卡尔积：两个集合 A 集合和 B 集合的所有组合情况（在多表查询时，需要消除无效的笛卡尔积）</p>
<p>消除无效笛卡尔积：<br>select * from employee, dept where employee.dept = dept.id;</p>
<p>内连接查询<br>内连接查询的是两张表交集的部分</p>
<p>隐式内连接：<br>SELECT 字段列表 FROM 表1, 表2 WHERE 条件 …;</p>
<p>显式内连接：<br>SELECT 字段列表 FROM 表1 [ INNER ] JOIN 表2 ON 连接条件 …;</p>
<p>显式性能比隐式高</p>
<p>例子：</p>
<p>— 查询员工姓名，及关联的部门的名称<br>— 隐式<br>select e.name, d.name from employee as e, dept as d where e.dept = d.id;<br>— 显式<br>select e.name, d.name from employee as e inner join dept as d on e.dept = d.id;<br>外连接查询<br>左外连接：<br>查询左表所有数据，以及两张表交集部分数据<br>SELECT 字段列表 FROM 表1 LEFT [ OUTER ] JOIN 表2 ON 条件 …;<br>相当于查询表 1 的所有数据，包含表 1 和表 2 交集部分数据</p>
<p>右外连接：<br>查询右表所有数据，以及两张表交集部分数据<br>SELECT 字段列表 FROM 表1 RIGHT [ OUTER ] JOIN 表2 ON 条件 …;</p>
<p>例子：</p>
<p>— 左<br>select e.<em>, d.name from employee as e left outer join dept as d on e.dept = d.id;<br>select d.name, e.</em> from dept d left outer join emp e on e.dept = d.id;  — 这条语句与下面的语句效果一样<br>— 右<br>select d.name, e.* from employee as e right outer join dept as d on e.dept = d.id;<br>左连接可以查询到没有 dept 的 employee，右连接可以查询到没有 employee 的 dept</p>
<p>自连接查询<br>当前表与自身的连接查询，自连接必须使用表别名</p>
<p>语法：<br>SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件 …;</p>
<p>自连接查询，可以是内连接查询，也可以是外连接查询</p>
<p>例子：</p>
<p>— 查询员工及其所属领导的名字<br>select a.name, b.name from employee a, employee b where a.manager = b.id;<br>— 没有领导的也查询出来<br>select a.name, b.name from employee a left join employee b on a.manager = b.id;<br>联合查询 union, union all<br>把多次查询的结果合并，形成一个新的查询集</p>
<p>语法：</p>
<p>SELECT 字段列表 FROM 表A …<br>UNION [ALL]<br>SELECT 字段列表 FROM 表B …<br>注意事项<br>UNION ALL 会有重复结果，UNION 不会<br>联合查询比使用 or 效率高，不会使索引失效<br>子查询<br>SQL 语句中嵌套 SELECT 语句，称谓嵌套查询，又称子查询。<br>SELECT * FROM t1 WHERE column1 = ( SELECT column1 FROM t2);<br>子查询外部的语句可以是 INSERT / UPDATE / DELETE / SELECT 的任何一个</p>
<p>根据子查询结果可以分为：</p>
<p>标量子查询（子查询结果为单个值）<br>列子查询（子查询结果为一列）<br>行子查询（子查询结果为一行）<br>表子查询（子查询结果为多行多列）<br>根据子查询位置可分为：</p>
<p>WHERE 之后<br>FROM 之后<br>SELECT 之后<br>标量子查询<br>子查询返回的结果是单个值（数字、字符串、日期等）。<br>常用操作符：- &lt;&gt;&gt; &gt;= &lt; &lt;=</p>
<p>例子：</p>
<p>— 查询销售部所有员工<br>select id from dept where name = ‘销售部’;<br>— 根据销售部部门ID，查询员工信息<br>select <em> from employee where dept = 4;<br>— 合并（子查询）<br>select </em> from employee where dept = (select id from dept where name = ‘销售部’);</p>
<p>— 查询xxx入职之后的员工信息<br>select * from employee where entrydate &gt; (select entrydate from employee where name = ‘xxx’);<br>列子查询<br>返回的结果是一列（可以是多行）。</p>
<p>常用操作符：</p>
<p>操作符    描述<br>IN    在指定的集合范围内，多选一<br>NOT IN    不在指定的集合范围内<br>ANY    子查询返回列表中，有任意一个满足即可<br>SOME    与 ANY 等同，使用 SOME 的地方都可以使用 ANY<br>ALL    子查询返回列表的所有值都必须满足<br>例子：</p>
<p>— 查询销售部和市场部的所有员工信息<br>select <em> from employee where dept in (select id from dept where name = ‘销售部’ or name = ‘市场部’);<br>— 查询比财务部所有人工资都高的员工信息<br>select </em> from employee where salary &gt; all(select salary from employee where dept = (select id from dept where name = ‘财务部’));<br>— 查询比研发部任意一人工资高的员工信息<br>select * from employee where salary &gt; any (select salary from employee where dept = (select id from dept where name = ‘研发部’));<br>行子查询<br>返回的结果是一行（可以是多列）。<br>常用操作符：=, &lt;,&gt;, IN, NOT IN</p>
<p>例子：</p>
<p>— 查询与xxx的薪资及直属领导相同的员工信息<br>select <em> from employee where (salary, manager) = (12500, 1);<br>select </em> from employee where (salary, manager) = (select salary, manager from employee where name = ‘xxx’);<br>表子查询<br>返回的结果是多行多列<br>常用操作符：IN</p>
<p>例子：</p>
<p>— 查询与xxx1，xxx2的职位和薪资相同的员工<br>select <em> from employee where (job, salary) in (select job, salary from employee where name = ‘xxx1’ or name = ‘xxx2’);<br>— 查询入职日期是2006-01-01之后的员工，及其部门信息<br>select e.</em>, d.<em> from (select </em> from employee where entrydate &gt; ‘2006-01-01’) as e left join dept as d on e.dept = d.id;<br>1.5 事务<br>事务是一组操作的集合，事务会把所有操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p>
<p>基本操作：</p>
<p>— 1. 查询张三账户余额<br>select * from account where name = ‘张三’;<br>— 2. 将张三账户余额-1000<br>update account set money = money - 1000 where name = ‘张三’;<br>— 此语句出错后张三钱减少但是李四钱没有增加<br>模拟sql语句错误<br>— 3. 将李四账户余额+1000<br>update account set money = money + 1000 where name = ‘李四’;</p>
<p>— 查看事务提交方式<br>SELECT @@AUTOCOMMIT;<br>— 设置事务提交方式，1为自动提交，0为手动提交，该设置只对当前会话有效<br>SET @@AUTOCOMMIT = 0;<br>— 提交事务<br>COMMIT;<br>— 回滚事务<br>ROLLBACK;</p>
<p>— 设置手动提交后上面代码改为：<br>select * from account where name = ‘张三’;<br>update account set money = money - 1000 where name = ‘张三’;<br>update account set money = money + 1000 where name = ‘李四’;<br>commit;<br>操作方式二：</p>
<p>开启事务：<br>START TRANSACTION 或 BEGIN TRANSACTION;<br>提交事务：<br>COMMIT;<br>回滚事务：<br>ROLLBACK;</p>
<p>操作实例：</p>
<p>start transaction;<br>select * from account where name = ‘张三’;<br>update account set money = money - 1000 where name = ‘张三’;<br>update account set money = money + 1000 where name = ‘李四’;<br>commit;<br>四大特性 ACID<br>原子性 (Atomicity)：事务是不可分割的最小操作但愿，要么全部成功，要么全部失败<br>一致性 (Consistency)：事务完成时，必须使所有数据都保持一致状态<br>隔离性 (Isolation)：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行<br>持久性 (Durability)：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的<br>并发事务<br>问题    描述<br>脏读    一个事务读到另一个事务还没提交的数据<br>不可重复读    一个事务先后读取同一条记录，但两次读取的数据不同<br>幻读    一个事务按照条件查询数据时，没有对应的数据行，但是再插入数据时，又发现这行数据已经存在<br>这三个问题的详细演示：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=55cd">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=55cd</a></p>
<p>并发事务隔离级别：</p>
<p>隔离级别    脏读    不可重复读    幻读<br>Read uncommitted    √    √    √<br>Read committed    ×    √    √<br>Repeatable Read (默认)    ×    ×    √<br>Serializable    ×    ×    ×<br>√ 表示在当前隔离级别下该问题会出现<br>Serializable 性能最低；Read uncommitted 性能最高，数据安全性最差<br>查看事务隔离级别：<br>SELECT @@TRANSACTION_ISOLATION;<br>设置事务隔离级别：<br>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE };<br>SESSION 是会话级别，表示只针对当前会话有效，GLOBAL 表示对所有会话有效</p>
<ol>
<li>进阶篇<br>2.1 存储引擎<br>MySQL 体系结构：</li>
</ol>
<p>结构图<br>层级描述</p>
<p>存储引擎就是存储数据、建立索引、更新 / 查询数据等技术的实现方式。存储引擎是基于表而不是基于库的，所以存储引擎也可以被称为表引擎。<br>默认存储引擎是 InnoDB。</p>
<p>相关操作：</p>
<p>— 查询建表语句<br>show create table account;<br>— 建表时指定存储引擎<br>CREATE TABLE 表名(<br>    …<br>) ENGINE=INNODB;<br>— 查看当前数据库支持的存储引擎<br>show engines;<br>InnoDB<br>InnoDB 是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，InnoDB 是默认的 MySQL 引擎。</p>
<p>特点：</p>
<p>DML 操作遵循 ACID 模型，支持事务<br>行级锁，提高并发访问性能<br>支持外键约束，保证数据的完整性和正确性<br>文件：</p>
<p>xxx.ibd: xxx 代表表名，InnoDB 引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（frm、sdi）、数据和索引。<br>参数：innodb_file_per_table，决定多张表共享一个表空间还是每张表对应一个表空间</p>
<p>知识点：</p>
<p>查看 Mysql 变量：<br>show variables like ‘innodb_file_per_table’;</p>
<p>从 idb 文件提取表结构数据：<br>（在 cmd 运行）<br>ibd2sdi xxx.ibd</p>
<p>InnoDB 逻辑存储结构：<br>InnoDB逻辑存储结构</p>
<p>MyISAM<br>MyISAM 是 MySQL 早期的默认存储引擎。</p>
<p>特点：</p>
<p>不支持事务，不支持外键<br>支持表锁，不支持行锁<br>访问速度快<br>文件：</p>
<p>xxx.sdi: 存储表结构信息<br>xxx.MYD: 存储数据<br>xxx.MYI: 存储索引<br>Memory<br>Memory 引擎的表数据是存储在内存中的，受硬件问题、断电问题的影响，只能将这些表作为临时表或缓存使用。</p>
<p>特点：</p>
<p>存放在内存中，速度快<br>hash 索引（默认）<br>文件：</p>
<p>xxx.sdi: 存储表结构信息<br>存储引擎特点<br>特点    InnoDB    MyISAM    Memory<br>存储限制    64TB    有    有<br>事务安全    支持    -    -<br>锁机制    行锁    表锁    表锁<br>B+tree 索引    支持    支持    支持<br>Hash 索引    -    -    支持<br>全文索引    支持（5.6 版本之后）    支持    -<br>空间使用    高    低    N/A<br>内存使用    高    低    中等<br>批量插入速度    低    高    高<br>支持外键    支持    -    -<br>存储引擎的选择<br>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p>
<p>InnoDB: 如果应用对事物的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，则 InnoDB 是比较合适的选择<br>MyISAM: 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不高，那这个存储引擎是非常合适的。<br>Memory: 将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。Memory 的缺陷是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性<br>电商中的足迹和评论适合使用 MyISAM 引擎，缓存适合使用 Memory 引擎。</p>
<p>2.2 性能分析<br>查看执行频次<br>查看当前数据库的 INSERT, UPDATE, DELETE, SELECT 访问频次：<br>SHOW GLOBAL STATUS LIKE ‘Com<strong><em>_</em></strong>‘; 或者 SHOW SESSION STATUS LIKE ‘Com<strong><em>_</em></strong>‘;<br>例：show global status like ‘Com<strong><em>_</em></strong>‘</p>
<p>慢查询日志<br>慢查询日志记录了所有执行时间超过指定参数（long_query_time，单位：秒，默认 10 秒）的所有 SQL 语句的日志。<br>MySQL 的慢查询日志默认没有开启，需要在 MySQL 的配置文件（/etc/my.cnf）中配置如下信息： # 开启慢查询日志开关<br>slow_query_log=1 # 设置慢查询日志的时间为 2 秒，SQL 语句执行时间超过 2 秒，就会视为慢查询，记录慢查询日志<br>long_query_time=2<br>更改后记得重启 MySQL 服务，日志文件位置：/var/lib/mysql/localhost-slow.log</p>
<p>查看慢查询日志开关状态：<br>show variables like ‘slow_query_log’;</p>
<p>profile<br>show profile 能在做 SQL 优化时帮我们了解时间都耗费在哪里。通过 have_profiling 参数，能看到当前 MySQL 是否支持 profile 操作：<br>SELECT @@have_profiling;<br>profiling 默认关闭，可以通过 set 语句在 session/global 级别开启 profiling：<br>SET profiling = 1;<br>查看所有语句的耗时：<br>show profiles;<br>查看指定 query_id 的 SQL 语句各个阶段的耗时：<br>show profile for query query_id;<br>查看指定 query_id 的 SQL 语句 CPU 的使用情况<br>show profile cpu for query query_id;</p>
<p>explain<br>EXPLAIN 或者 DESC 命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序。<br>语法： # 直接在 select 语句之前加上关键字 explain /desc<br>EXPLAIN SELECT 字段列表 FROM 表名 HWERE 条件；</p>
<p>EXPLAIN 各字段含义：</p>
<p>id：select 查询的序列号，表示查询中执行 select 子句或者操作表的顺序（id 相同，执行顺序从上到下；id 不同，值越大越先执行）<br>select_type：表示 SELECT 的类型，常见取值有 SIMPLE（简单表，即不适用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION 中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE 之后包含了子查询）等<br>type：表示连接类型，性能由好到差的连接类型为 NULL、system、const、eq_ref、ref、range、index、all<br>possible_key：可能应用在这张表上的索引，一个或多个<br>Key：实际使用的索引，如果为 NULL，则没有使用索引<br>Key_len：表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好<br>rows：MySQL 认为必须要执行的行数，在 InnoDB 引擎的表中，是一个估计值，可能并不总是准确的<br>filtered：表示返回结果的行数占需读取行数的百分比，filtered 的值越大越好<br>2.3 索引<br>索引是帮助 MySQL 高效获取数据的数据结构（有序）。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查询算法，这种数据结构就是索引。</p>
<p>优缺点：</p>
<p>优点：</p>
<p>提高数据检索效率，降低数据库的 IO 成本<br>通过索引列对数据进行排序，降低数据排序的成本，降低 CPU 的消耗<br>缺点：</p>
<p>索引列也是要占用空间的<br>索引大大提高了查询效率，但降低了更新的速度，比如 INSERT、UPDATE、DELETE<br>索引结构<br>索引结构    描述<br>B+Tree    最常见的索引类型，大部分引擎都支持 B + 树索引<br>Hash    底层数据结构是用哈希表实现，只有精确匹配索引列的查询才有效，不支持范围查询<br>R-Tree (空间索引)    空间索引是 MyISAM 引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少<br>Full-Text (全文索引)    是一种通过建立倒排索引，快速匹配文档的方式，类似于 Lucene, Solr, ES<br>索引    InnoDB    MyISAM    Memory<br>B+Tree 索引    支持    支持    支持<br>Hash 索引    不支持    不支持    支持<br>R-Tree 索引    不支持    支持    不支持<br>Full-text    5.6 版本后支持    支持    不支持<br>B-Tree<br>二叉树</p>
<p>二叉树的缺点可以用红黑树来解决：<br>红黑树<br>红黑树也存在大数据量情况下，层级较深，检索速度慢的问题。</p>
<p>为了解决上述问题，可以使用 B-Tree 结构。<br>B-Tree (多路平衡查找树) 以一棵最大度数（max-degree，指一个节点的子节点个数）为 5（5 阶）的 b-tree 为例（每个节点最多存储 4 个 key，5 个指针）</p>
<p>B-Tree结构</p>
<p>B-Tree 的数据插入过程动画参照：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=68">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=68</a><br>演示地址：<a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BTree.html">https://www.cs.usfca.edu/~galles/visualization/BTree.html</a></p>
<p>B+Tree<br>结构图：</p>
<p>B+Tree结构图</p>
<p>演示地址：<a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a></p>
<p>与 B-Tree 的区别：</p>
<p>所有的数据都会出现在叶子节点<br>叶子节点形成一个单向链表<br>MySQL 索引数据结构对经典的 B+Tree 进行了优化。在原 B+Tree 的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的 B+Tree，提高区间访问的性能。</p>
<p>MySQL B+Tree 结构图</p>
<p>Hash<br>哈希索引就是采用一定的 hash 算法，将键值换算成新的 hash 值，映射到对应的槽位上，然后存储在 hash 表中。<br>如果两个（或多个）键值，映射到一个相同的槽位上，他们就产生了 hash 冲突（也称为 hash 碰撞），可以通过链表来解决。</p>
<p>Hash索引原理图</p>
<p>特点：</p>
<p>Hash 索引只能用于对等比较（=、in），不支持范围查询（betwwn、&gt;、&lt;、…）<br>无法利用索引完成排序操作<br>查询效率高，通常只需要一次检索就可以了，效率通常要高于 B+Tree 索引<br>存储引擎支持：</p>
<p>Memory<br>InnoDB: 具有自适应 hash 功能，hash 索引是存储引擎根据 B+Tree 索引在指定条件下自动构建的<br>面试题<br>为什么 InnoDB 存储引擎选择使用 B+Tree 索引结构？<br>相对于二叉树，层级更少，搜索效率高<br>对于 B-Tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针也跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低<br>相对于 Hash 索引，B+Tree 支持范围匹配及排序操作<br>索引分类<br>分类    含义    特点    关键字<br>主键索引    针对于表中主键创建的索引    默认自动创建，只能有一个    PRIMARY<br>唯一索引    避免同一个表中某数据列中的值重复    可以有多个    UNIQUE<br>常规索引    快速定位特定数据    可以有多个<br>全文索引    全文索引查找的是文本中的关键词，而不是比较索引中的值    可以有多个    FULLTEXT<br>在 InnoDB 存储引擎中，根据索引的存储形式，又可以分为以下两种：</p>
<p>分类    含义    特点<br>聚集索引 (Clustered Index)    将数据存储与索引放一块，索引结构的叶子节点保存了行数据    必须有，而且只有一个<br>二级索引 (Secondary Index)    将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键    可以存在多个<br>演示图：</p>
<p>大致原理<br>演示图</p>
<p>聚集索引选取规则：</p>
<p>如果存在主键，主键索引就是聚集索引<br>如果不存在主键，将使用第一个唯一 (UNIQUE) 索引作为聚集索引<br>如果表没有主键或没有合适的唯一索引，则 InnoDB 会自动生成一个 rowid 作为隐藏的聚集索引<br>思考题</p>
<ol>
<li>以下 SQL 语句，哪个执行效率高？为什么？</li>
</ol>
<p>select <em> from user where id = 10;<br>select </em> from user where name = ‘Arm’;<br>— 备注：id为主键，name字段创建的有索引<br>答：第一条语句，因为第二条需要回表查询，相当于两个步骤。</p>
<ol>
<li>InnoDB 主键索引的 B+Tree 高度为多少？</li>
</ol>
<p>答：假设一行数据大小为 1k，一页中可以存储 16 行这样的数据。InnoDB 的指针占用 6 个字节的空间，主键假设为 bigint，占用字节数为 8.<br>可得公式：n <em> 8 + (n + 1) </em> 6 = 16 * 1024，其中 8 表示 bigint 占用的字节数，n 表示当前节点存储的 key 的数量，(n + 1) 表示指针数量（比 key 多一个）。算出 n 约为 1170。</p>
<p>如果树的高度为 2，那么他能存储的数据量大概为：1171 <em> 16 = 18736；<br>如果树的高度为 3，那么他能存储的数据量大概为：1171 </em> 1171 * 16 = 21939856。</p>
<p>另外，如果有成千上万的数据，那么就要考虑分表，涉及运维篇知识。</p>
<p>语法<br>创建索引：<br>CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (index_col_name, …);<br>如果不加 CREATE 后面不加索引类型参数，则创建的是常规索引</p>
<p>查看索引：<br>SHOW INDEX FROM table_name;</p>
<p>删除索引：<br>DROP INDEX index_name ON table_name;</p>
<p>案例：</p>
<p>— name字段为姓名字段，该字段的值可能会重复，为该字段创建索引<br>create index idx_user_name on tb_user(name);<br>— phone手机号字段的值非空，且唯一，为该字段创建唯一索引<br>create unique index idx_user_phone on tb_user (phone);<br>— 为profession, age, status创建联合索引<br>create index idx_user_pro_age_stat on tb_user(profession, age, status);<br>— 为email建立合适的索引来提升查询效率<br>create index idx_user_email on tb_user(email);</p>
<p>— 删除索引<br>drop index idx_user_email on tb_user;<br>使用规则<br>最左前缀法则<br>如果索引关联了多列（联合索引），要遵守最左前缀法则，最左前缀法则指的是查询从索引的最左列开始，并且不跳过索引中的列。<br>如果跳跃某一列，索引将部分失效（后面的字段索引失效）。</p>
<p>联合索引中，出现范围查询（&lt;,&gt;），范围查询右侧的列索引失效。可以用 &gt;= 或者 &lt;= 来规避索引失效问题。</p>
<p>索引失效情况<br>在索引列上进行运算操作，索引将失效。如：explain select <em> from tb_user where substring(phone, 10, 2) = ‘15’;<br>字符串类型字段使用时，不加引号，索引将失效。如：explain select </em> from tb_user where phone = 17799990015;，此处 phone 的值没有加引号<br>模糊查询中，如果仅仅是尾部模糊匹配，索引不会是失效；如果是头部模糊匹配，索引失效。如：explain select * from tb_user where profession like ‘%工程’;，前后都有 % 也会失效。<br>用 or 分割开的条件，如果 or 其中一个条件的列没有索引，那么涉及的索引都不会被用到。<br>如果 MySQL 评估使用索引比全表更慢，则不使用索引。<br>SQL 提示<br>是优化数据库的一个重要手段，简单来说，就是在 SQL 语句中加入一些人为的提示来达到优化操作的目的。</p>
<p>例如，使用索引：<br>explain select <em> from tb_user use index(idx_user_pro) where profession=”软件工程”;<br>不使用哪个索引：<br>explain select </em> from tb_user ignore index(idx_user_pro) where profession=”软件工程”;<br>必须使用哪个索引：<br>explain select * from tb_user force index(idx_user_pro) where profession=”软件工程”;</p>
<p>use 是建议，实际使用哪个索引 MySQL 还会自己权衡运行速度去更改，force 就是无论如何都强制使用该索引。</p>
<p>覆盖索引 &amp; 回表查询<br>尽量使用覆盖索引（查询使用了索引，并且需要返回的列，在该索引中已经全部能找到），减少 select *。</p>
<p>explain 中 extra 字段含义：<br>using index condition：查找使用了索引，但是需要回表查询数据<br>using where; using index;：查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询</p>
<p>如果在聚集索引中直接能找到对应的行，则直接返回行数据，只需要一次查询，哪怕是 select *；如果在辅助索引中找聚集索引，如 select id, name from xxx where name=’xxx’;，也只需要通过辅助索引 (name) 查找到对应的 id，返回 name 和 name 索引对应的 id 即可，只需要一次查询；如果是通过辅助索引查找其他字段，则需要回表查询，如 select id, name, gender from xxx where name=’xxx’;</p>
<p>所以尽量不要用 select *，容易出现回表查询，降低效率，除非有联合索引包含了所有字段</p>
<p>面试题：一张表，有四个字段（id, username, password, status），由于数据量大，需要对以下 SQL 语句进行优化，该如何进行才是最优方案：<br>select id, username, password from tb_user where username=’itcast’;</p>
<p>解：给 username 和 password 字段建立联合索引，则不需要回表查询，直接覆盖索引</p>
<p>前缀索引<br>当字段类型为字符串（varchar, text 等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘 IO，影响查询效率，此时可以只降字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p>
<p>语法：create index idx_xxxx on table_name(columnn(n));<br>前缀长度：可以根据索引的选择性来决定，而选择性是指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高，唯一索引的选择性是 1，这是最好的索引选择性，性能也是最好的。<br>求选择性公式：</p>
<p>select count(distinct email) / count(<em>) from tb_user;<br>select count(distinct substring(email, 1, 5)) / count(</em>) from tb_user;<br>show index 里面的 sub_part 可以看到接取的长度</p>
<p>单列索引 &amp; 联合索引<br>单列索引：即一个索引只包含单个列<br>联合索引：即一个索引包含了多个列<br>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单列索引。</p>
<p>单列索引情况：<br>explain select id, phone, name from tb_user where phone = ‘17799990010’ and name = ‘韩信’;<br>这句只会用到 phone 索引字段</p>
<p>注意事项<br>多条件联合查询时，MySQL 优化器会评估哪个字段的索引效率更高，会选择该索引完成本次查询<br>设计原则<br>针对于数据量较大，且查询比较频繁的表建立索引<br>针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引<br>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高<br>如果是字符串类型的字段，字段长度较长，可以针对于字段的特点，建立前缀索引<br>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率<br>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价就越大，会影响增删改的效率<br>如果索引列不能存储 NULL 值，请在创建表时使用 NOT NULL 约束它。当优化器知道每列是否包含 NULL 值时，它可以更好地确定哪个索引最有效地用于查询<br>2.4 SQL 优化<br>插入数据<br>普通插入：</p>
<p>采用批量插入（一次插入的数据不建议超过 1000 条）<br>手动提交事务<br>主键顺序插入<br>大批量插入：<br>如果一次性需要插入大批量数据，使用 insert 语句插入性能较低，此时可以使用 MySQL 数据库提供的 load 指令插入。</p>
<h1 id="客户端连接服务端时，加上参数-—local-infile（这一行在bash-cmd界面输入）"><a href="#客户端连接服务端时，加上参数-—local-infile（这一行在bash-cmd界面输入）" class="headerlink" title="客户端连接服务端时，加上参数 —local-infile（这一行在bash/cmd界面输入）"></a>客户端连接服务端时，加上参数 —local-infile（这一行在bash/cmd界面输入）</h1><p>mysql —local-infile -u root -p</p>
<h1 id="设置全局参数local-infile为1，开启从本地加载文件导入数据的开关"><a href="#设置全局参数local-infile为1，开启从本地加载文件导入数据的开关" class="headerlink" title="设置全局参数local_infile为1，开启从本地加载文件导入数据的开关"></a>设置全局参数local_infile为1，开启从本地加载文件导入数据的开关</h1><p>set global local_infile = 1;<br>select @@local_infile;</p>
<h1 id="执行load指令将准备好的数据，加载到表结构中"><a href="#执行load指令将准备好的数据，加载到表结构中" class="headerlink" title="执行load指令将准备好的数据，加载到表结构中"></a>执行load指令将准备好的数据，加载到表结构中</h1><p>load data local infile ‘/root/sql1.log’ into table ‘tb_user’ fields terminated by ‘,’ lines terminated by ‘\n’;<br>主键优化<br>数据组织方式：在 InnoDB 存储引擎中，表数据都是根据主键顺序组织存放的，这种存储方式的表称为索引组织表（Index organized table, IOT）</p>
<p>页分裂：页可以为空，也可以填充一般，也可以填充 100%，每个页包含了 2-N 行数据（如果一行数据过大，会行溢出），根据主键排列。<br>页合并：当删除一行记录时，实际上记录并没有被物理删除，只是记录被标记（flaged）为删除并且它的空间变得允许被其他记录声明使用。当页中删除的记录到达 MERGE_THRESHOLD（默认为页的 50%），InnoDB 会开始寻找最靠近的页（前后）看看是否可以将这两个页合并以优化空间使用。</p>
<p>MERGE_THRESHOLD：合并页的阈值，可以自己设置，在创建表或创建索引时指定</p>
<p>文字说明不够清晰明了，具体可以看视频里的 PPT 演示过程：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=90">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=90</a></p>
<p>主键设计原则：</p>
<p>满足业务需求的情况下，尽量降低主键的长度<br>插入数据时，尽量选择顺序插入，选择使用 AUTO_INCREMENT 自增主键<br>尽量不要使用 UUID 做主键或者是其他的自然主键，如身份证号<br>业务操作时，避免对主键的修改<br>order by 优化<br>Using filesort：通过表的索引或全表扫描，读取满足条件的数据行，然后在排序缓冲区 sort buffer 中完成排序操作，所有不是通过索引直接返回排序结果的排序都叫 FileSort 排序<br>Using index：通过有序索引顺序扫描直接返回有序数据，这种情况即为 using index，不需要额外排序，操作效率高<br>如果 order by 字段全部使用升序排序或者降序排序，则都会走索引，但是如果一个字段升序排序，另一个字段降序排序，则不会走索引，explain 的 extra 信息显示的是 Using index, Using filesort，如果要优化掉 Using filesort，则需要另外再创建一个索引，如：create index idx_user_age_phone_ad on tb_user(age asc, phone desc);，此时使用 select id, age, phone from tb_user order by age asc, phone desc; 会全部走索引</p>
<p>总结：</p>
<p>根据排序字段建立合适的索引，多字段排序时，也遵循最左前缀法则<br>尽量使用覆盖索引<br>多字段排序，一个升序一个降序，此时需要注意联合索引在创建时的规则（ASC/DESC）<br>如果不可避免出现 filesort，大数据量排序时，可以适当增大排序缓冲区大小 sort_buffer_size（默认 256k）<br>group by 优化<br>在分组操作时，可以通过索引来提高效率<br>分组操作时，索引的使用也是满足最左前缀法则的<br>如索引为 idx_user_pro_age_stat，则句式可以是 select … where profession order by age，这样也符合最左前缀法则</p>
<p>limit 优化<br>常见的问题如 limit 2000000, 10，此时需要 MySQL 排序前 2000000 条记录，但仅仅返回 2000000 - 2000010 的记录，其他记录丢弃，查询排序的代价非常大。<br>优化方案：一般分页查询时，通过创建覆盖索引能够比较好地提高性能，可以通过覆盖索引加子查询形式进行优化</p>
<p>例如：</p>
<p>— 此语句耗时很长<br>select <em> from tb_sku limit 9000000, 10;<br>— 通过覆盖索引加快速度，直接通过主键索引进行排序及查询<br>select id from tb_sku order by id limit 9000000, 10;<br>— 下面的语句是错误的，因为 MySQL 不支持 in 里面使用 limit<br>— select </em> from tb_sku where id in (select id from tb_sku order by id limit 9000000, 10);<br>— 通过连表查询即可实现第一句的效果，并且能达到第二句的速度<br>select <em> from tb_sku as s, (select id from tb_sku order by id limit 9000000, 10) as a where s.id = a.id;<br>count 优化<br>MyISAM 引擎把一个表的总行数存在了磁盘上，因此执行 count (</em>) 的时候会直接返回这个数，效率很高（前提是不适用 where）；<br>InnoDB 在执行 count (*) 时，需要把数据一行一行地从引擎里面读出来，然后累计计数。<br>优化方案：自己计数，如创建 key-value 表存储在内存或硬盘，或者是用 redis</p>
<p>count 的几种用法：</p>
<p>如果 count 函数的参数（count 里面写的那个字段）不是 NULL（字段值不为 NULL），累计值就加一，最后返回累计值<br>用法：count (<em>)、count (主键)、count (字段)、count (1)<br>count (主键) 跟 count (</em>) 一样，因为主键不能为空；count (字段) 只计算字段值不为 NULL 的行；count (1) 引擎会为每行添加一个 1，然后就 count 这个 1，返回结果也跟 count (*) 一样；count (null) 返回 0<br>各种用法的性能：</p>
<p>count (主键)：InnoDB 引擎会遍历整张表，把每行的主键 id 值都取出来，返回给服务层，服务层拿到主键后，直接按行进行累加（主键不可能为空）<br>count (字段)：没有 not null 约束的话，InnoDB 引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，服务层判断是否为 null，不为 null，计数累加；有 not null 约束的话，InnoDB 引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，直接按行进行累加<br>count (1)：InnoDB 引擎遍历整张表，但不取值。服务层对于返回的每一层，放一个数字 1 进去，直接按行进行累加<br>count (<em>)：InnoDB 引擎并不会把全部字段取出来，而是专门做了优化，不取值，服务层直接按行进行累加<br>按效率排序：count (字段) &lt; count (主键) &lt; count (1) &lt; count (</em>)，所以尽量使用 count (*)</p>
<p>update 优化（避免行锁升级为表锁）<br>InnoDB 的行锁是针对索引加的锁，不是针对记录加的锁，并且该索引不能失效，否则会从行锁升级为表锁。</p>
<p>如以下两条语句：<br>update student set no = ‘123’ where id = 1;，这句由于 id 有主键索引，所以只会锁这一行；<br>update student set no = ‘123’ where name = ‘test’;，这句由于 name 没有索引，所以会把整张表都锁住进行数据更新，解决方法是给 name 字段添加索引</p>
<ol>
<li>数据类型<br>整型<br>类型名称    取值范围    大小<br>TINYINT    -128〜127    1 个字节<br>SMALLINT    -32768〜32767    2 个宇节<br>MEDIUMINT    -8388608〜8388607    3 个字节<br>INT (INTEGHR)    -2147483648〜2147483647    4 个字节<br>BIGINT    -9223372036854775808〜9223372036854775807    8 个字节<br>无符号在数据类型后加 unsigned 关键字。</li>
</ol>
<p>浮点型<br>类型名称    说明    存储需求<br>FLOAT    单精度浮点数    4 个字节<br>DOUBLE    双精度浮点数    8 个字节<br>DECIMAL (M, D)，DEC    压缩的 “严格” 定点数    M+2 个字节<br>日期和时间<br>类型名称    日期格式    日期范围    存储需求<br>YEAR    YYYY    1901 ~ 2155    1 个字节<br>TIME    HH:MM:SS    -838:59:59 ~ 838:59:59    3 个字节<br>DATE    YYYY-MM-DD    1000-01-01 ~ 9999-12-3    3 个字节<br>DATETIME    YYYY-MM-DD HH:MM:SS    1000-01-01 00:00:00 ~ 9999-12-31 23:59:59    8 个字节<br>TIMESTAMP    YYYY-MM-DD HH:MM:SS    1980-01-01 00:00:01 UTC ~ 2040-01-19 03:14:07 UTC    4 个字节<br>字符串<br>类型名称    说明    存储需求<br>CHAR(M)    固定长度非二进制字符串    M 字节，1&lt;=M&lt;=255<br>VARCHAR(M)    变长非二进制字符串    L+1 字节，在此，L&lt; = M 和 1&lt;=M&lt;=255<br>TINYTEXT    非常小的非二进制字符串    L+1 字节，在此，L&lt;2^8<br>TEXT    小的非二进制字符串    L+2 字节，在此，L&lt;2^16<br>MEDIUMTEXT    中等大小的非二进制字符串    L+3 字节，在此，L&lt;2^24<br>LONGTEXT    大的非二进制字符串    L+4 字节，在此，L&lt;2^32<br>ENUM    枚举类型，只能有一个枚举字符串值    1 或 2 个字节，取决于枚举值的数目 (最大值为 65535)<br>SET    一个设置，字符串对象可以有零个或 多个 SET 成员    1、2、3、4 或 8 个字节，取决于集合 成员的数量（最多 64 个成员）<br>二进制类型<br>类型名称    说明    存储需求<br>BIT(M)    位字段类型    大约 (M+7)/8 字节<br>BINARY(M)    固定长度二进制字符串    M 字节<br>VARBINARY (M)    可变长度二进制字符串    M+1 字节<br>TINYBLOB (M)    非常小的 BLOB    L+1 字节，在此，L&lt;2^8<br>BLOB (M)    小 BLOB    L+2 字节，在此，L&lt;2^16<br>MEDIUMBLOB (M)    中等大小的 BLOB    L+3 字节，在此，L&lt;2^24<br>LONGBLOB (M)    非常大的 BLOB    L+4 字节，在此，L&lt;2^32</p>
<ol>
<li>权限一览表<br>具体权限的作用详见官方文档</li>
</ol>
<p>GRANT 和 REVOKE 允许的静态权限</p>
<p>Privilege    Grant Table Column    Context<br>ALL [PRIVILEGES]    Synonym for “all privileges”    Server administration<br>ALTER    Alter_priv    Tables<br>ALTER ROUTINE    Alter_routine_priv    Stored routines<br>CREATE    Create_priv    Databases, tables, or indexes<br>CREATE ROLE    Create_role_priv    Server administration<br>CREATE ROUTINE    Create_routine_priv    Stored routines<br>CREATE TABLESPACE    Create_tablespace_priv    Server administration<br>CREATE TEMPORARY TABLES    Create_tmp_table_priv    Tables<br>CREATE USER    Create_user_priv    Server administration<br>CREATE VIEW    Create_view_priv    Views<br>DELETE    Delete_priv    Tables<br>DROP    Drop_priv    Databases, tables, or views<br>DROP ROLE    Drop_role_priv    Server administration<br>EVENT    Event_priv    Databases<br>EXECUTE    Execute_priv    Stored routines<br>FILE    File_priv    File access on server host<br>GRANT OPTION    Grant_priv    Databases, tables, or stored routines<br>INDEX    Index_priv    Tables<br>INSERT    Insert_priv    Tables or columns<br>LOCK TABLES    Lock_tables_priv    Databases<br>PROCESS    Process_priv    Server administration<br>PROXY    See proxies_priv table    Server administration<br>REFERENCES    References_priv    Databases or tables<br>RELOAD    Reload_priv    Server administration<br>REPLICATION CLIENT    Repl_client_priv    Server administration<br>REPLICATION SLAVE    Repl_slave_priv    Server administration<br>SELECT    Select_priv    Tables or columns<br>SHOW DATABASES    Show_db_priv    Server administration<br>SHOW VIEW    Show_view_priv    Views<br>SHUTDOWN    Shutdown_priv    Server administration<br>SUPER    Super_priv    Server administration<br>TRIGGER    Trigger_priv    Tables<br>UPDATE    Update_priv    Tables or columns<br>USAGE    Synonym for “no privileges”    Server administration<br>GRANT 和 REVOKE 允许的动态权限</p>
<p>Privilege    Context<br>APPLICATION_PASSWORD_ADMIN    Dual password administration<br>AUDIT_ABORT_EXEMPT    Allow queries blocked by audit log filter<br>AUDIT_ADMIN    Audit log administration<br>AUTHENTICATION_POLICY_ADMIN    Authentication administration<br>BACKUP_ADMIN    Backup administration<br>BINLOG_ADMIN    Backup and Replication administration<br>BINLOG_ENCRYPTION_ADMIN    Backup and Replication administration<br>CLONE_ADMIN    Clone administration<br>CONNECTION_ADMIN    Server administration<br>ENCRYPTION_KEY_ADMIN    Server administration<br>FIREWALL_ADMIN    Firewall administration<br>FIREWALL_EXEMPT    Firewall administration<br>FIREWALL_USER    Firewall administration<br>FLUSH_OPTIMIZER_COSTS    Server administration<br>FLUSH_STATUS    Server administration<br>FLUSH_TABLES    Server administration<br>FLUSH_USER_RESOURCES    Server administration<br>GROUP_REPLICATION_ADMIN    Replication administration<br>GROUP_REPLICATION_STREAM    Replication administration<br>INNODB_REDO_LOG_ARCHIVE    Redo log archiving administration<br>NDB_STORED_USER    NDB Cluster<br>PASSWORDLESS_USER_ADMIN    Authentication administration<br>PERSIST_RO_VARIABLES_ADMIN    Server administration<br>REPLICATION_APPLIER    PRIVILEGE_CHECKS_USER for a replication channel<br>REPLICATION_SLAVE_ADMIN    Replication administration<br>RESOURCE_GROUP_ADMIN    Resource group administration<br>RESOURCE_GROUP_USER    Resource group administration<br>ROLE_ADMIN    Server administration<br>SESSION_VARIABLES_ADMIN    Server administration<br>SET_USER_ID    Server administration<br>SHOW_ROUTINE    Server administration<br>SYSTEM_USER    Server administration<br>SYSTEM_VARIABLES_ADMIN    Server administration<br>TABLE_ENCRYPTION_ADMIN    Server administration<br>VERSION_TOKEN_ADMIN    Server administration<br>XA_RECOVER_ADMIN    Server administration</p>
<ol>
<li>图形化界面工具<br>Workbench (免费): <a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/workbench/">http://dev.mysql.com/downloads/workbench/</a><br>navicat (收费，试用版 30 天): <a target="_blank" rel="noopener" href="https://www.navicat.com/en/download/navicat-for-mysql">https://www.navicat.com/en/download/navicat-for-mysql</a><br>Sequel Pro (开源免费，仅支持 Mac OS): <a target="_blank" rel="noopener" href="http://www.sequelpro.com/">http://www.sequelpro.com/</a><br>HeidiSQL (免费): <a target="_blank" rel="noopener" href="http://www.heidisql.com/">http://www.heidisql.com/</a><br>phpMyAdmin (免费): <a target="_blank" rel="noopener" href="https://www.phpmyadmin.net/">https://www.phpmyadmin.net/</a><br>SQLyog: <a target="_blank" rel="noopener" href="https://sqlyog.en.softonic.com/">https://sqlyog.en.softonic.com/</a></li>
<li>安装</li>
<li>小技巧<br>在 SQL 语句之后加上 \G 会将结果的表格形式转换成行文本形式<br>查看 Mysql 数据库占用空间：<br>SELECT table_schema “Database Name”<br>  , SUM(data_length + index_length) / (1024 * 1024) “Database Size in MB”<br>FROM information_schema.TABLES<br>GROUP BY table_schema;</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>数据库之mysql</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.chengjingyu.xyz/2022/04/22/mysql/">https://www.chengjingyu.xyz/2022/04/22/mysql/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>cjy</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2022-04-22</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2022-12-11</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://pic.chengjingyu.xyz/pic.chengjingyu.xyz/img_win/default_cover_113.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By cjy</div><div class="footer_custom_text">Hope you hava a nice day!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://love.chengjingyu.xyz/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://love.chengjingyu.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer src="/js/light.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>